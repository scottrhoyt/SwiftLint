#!/bin/bash

# Set `time` format
TIMEFORMAT=%R

# Testing Variables
TEST_REPO_BASE_URL='https://github.com/Carthage/Carthage'
TEST_TAG_NAME='0.11'
TEST_REPO_DIR='TEST_REPO'
TEST_CONFIG='script/.swiftlint.yml'

# Download Repo
echo "Checking out the test repo. This will take some time."
git clone "$TEST_REPO_BASE_URL.git" $TEST_REPO_DIR 1>/dev/null 2>/dev/null
cd $TEST_REPO_DIR
git checkout $TEST_TAG_NAME 1>/dev/null 2>/dev/null
make bootstrap 1>/dev/null 2>/dev/null
cd ..

echo "Running benchmarks. This will take some time."
# Capture time to run installed SwiftLint
INSTALLED_VERSION_TIME1=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
INSTALLED_VERSION_TIME2=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
INSTALLED_VERSION_TIME3=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
INSTALLED_VERSION_TIME4=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
INSTALLED_VERSION_TIME5=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.

# Install built version
sudo installer -allowUntrusted -pkg swiftlint.pkg -target /

# Capture time to run built SwiftLint
BUILT_VERSION_TIME1=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
BUILT_VERSION_TIME2=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
BUILT_VERSION_TIME3=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
BUILT_VERSION_TIME4=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.
BUILT_VERSION_TIME5=$( { time swiftlint lint --path $TEST_REPO_DIR --config $TEST_CONFIG 1>/dev/null 2>/dev/null; } 2>&1 )  # Captures time only.

printf "Installed time1: $INSTALLED_VERSION_TIME1\nInstalled time2: $INSTALLED_VERSION_TIME2\nInstalled time3: $INSTALLED_VERSION_TIME3\nInstalled time4: $INSTALLED_VERSION_TIME4\nInstalled time5: $INSTALLED_VERSION_TIME5\nBuilt time1: $BUILT_VERSION_TIME1\nBuilt time2: $BUILT_VERSION_TIME2\nBuilt time3: $BUILT_VERSION_TIME3\nBuilt time4: $BUILT_VERSION_TIME4\nBuilt time5: $BUILT_VERSION_TIME5\n"
